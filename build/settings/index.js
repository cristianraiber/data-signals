(()=>{"use strict";var s,a={168(s,a,e){const t=window.wp.element,i=window.wp.apiFetch;var n=e.n(i);const d=window.wp.i18n,l=window.wp.components,o=window.ReactJSXRuntime,r=({title:s,fields:a,data:e,onChange:t,onSave:i,saving:n,hideHeader:r=!1,hideFooter:c=!1})=>(0,o.jsxs)("div",{className:"ds-settings-card"+(r?" ds-settings-card-inline":""),children:[!r&&(0,o.jsx)("div",{className:"ds-settings-card-header",children:(0,o.jsx)("h3",{children:s})}),(0,o.jsx)("div",{className:"ds-settings-card-body",children:a.map(s=>{const a=e[s.id];return"boolean"===s.type?(0,o.jsx)(l.ToggleControl,{__nextHasNoMarginBottom:!0,label:s.label,help:s.description,checked:!!a,onChange:a=>t({[s.id]:a})},s.id):s.elements&&s.elements.length>0?(0,o.jsx)(l.SelectControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,label:s.label,help:s.description,value:a||"",options:s.elements,onChange:a=>t({[s.id]:a})},s.id):"text"===s.type&&"input"===s.Edit?(0,o.jsx)(l.TextControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,label:s.label,help:s.description,value:a||"",onChange:a=>t({[s.id]:a}),placeholder:s.placeholder||""},s.id):null})}),!c&&(0,o.jsx)("div",{className:"ds-settings-card-footer",children:(0,o.jsx)(l.Button,{variant:"primary",onClick:i,isBusy:n,disabled:n,children:n?(0,d.__)("Savingâ€¦","data-signals"):(0,d.__)("Save","data-signals")})})]}),c=[{id:"gdpr_mode",label:(0,d.__)("Enable GDPR Mode","data-signals"),type:"boolean",Edit:"toggle",description:(0,d.__)("Privacy-compliant analytics for EU/EEA sites.","data-signals")}],g=[(0,d.__)("IP addresses are anonymized before processing","data-signals"),(0,d.__)("Do Not Track (DNT) browser header is respected","data-signals"),(0,d.__)("No cookies are used (fingerprint-based sessions)","data-signals"),(0,d.__)("Session data rotates daily for privacy","data-signals"),(0,d.__)("No personal identifiable information is stored","data-signals")],_=[{id:"exclude_administrators",label:(0,d.__)("Exclude Logged-in Admins","data-signals"),type:"boolean",Edit:"toggle",description:(0,d.__)("Do not track pageviews from administrators.","data-signals")},{id:"exclude_editors",label:(0,d.__)("Exclude Editors","data-signals"),type:"boolean",Edit:"toggle",description:(0,d.__)("Do not track pageviews from editors.","data-signals")}],h=[{id:"maxmind_license_key",label:(0,d.__)("MaxMind License Key","data-signals"),type:"text",Edit:"input",description:(0,d.__)("Free license key from maxmind.com. Required for automatic GeoLite2 database downloads.","data-signals"),placeholder:"xxxxxxxxxxxxxxxx"},{id:"geo_use_cloudflare",label:(0,d.__)("Use Cloudflare IP Geolocation","data-signals"),type:"boolean",Edit:"toggle",description:(0,d.__)("Use Cloudflare CF-IPCountry header if available. Requires IP Geolocation enabled in Cloudflare.","data-signals")},{id:"geo_api_fallback",label:(0,d.__)("Enable API Fallback (Dev Only)","data-signals"),type:"boolean",Edit:"toggle",description:(0,d.__)("Fall back to ip-api.com when GeoLite2 unavailable. Rate limited (45 req/min), not for production.","data-signals")},{id:"geolite2_db_path",label:(0,d.__)("GeoLite2 Database Path (Optional)","data-signals"),type:"text",Edit:"input",description:(0,d.__)("Custom path to GeoLite2-Country.mmdb. Leave empty for automatic download to wp-content/uploads/data-signals/.","data-signals")}],x=[{id:"prune_data_after_months",label:(0,d.__)("Data Retention Period","data-signals"),type:"text",elements:[{value:"6",label:(0,d.__)("6 months","data-signals")},{value:"12",label:(0,d.__)("1 year","data-signals")},{value:"24",label:(0,d.__)("2 years","data-signals")},{value:"36",label:(0,d.__)("3 years","data-signals")},{value:"0",label:(0,d.__)("Forever","data-signals")}],description:(0,d.__)("How long to keep analytics data before automatic deletion.","data-signals")}],m=[{id:"default_view",label:(0,d.__)("Default Date Range","data-signals"),type:"text",elements:[{value:"last_7_days",label:(0,d.__)("Last 7 days","data-signals")},{value:"last_14_days",label:(0,d.__)("Last 14 days","data-signals")},{value:"last_28_days",label:(0,d.__)("Last 28 days","data-signals")},{value:"this_month",label:(0,d.__)("This month","data-signals")}],description:(0,d.__)("Default time period shown on the dashboard.","data-signals")},{id:"is_dashboard_public",label:(0,d.__)("Public Dashboard","data-signals"),type:"boolean",Edit:"toggle",description:(0,d.__)("Allow anyone with the REST API endpoint to view stats (no auth required).","data-signals")}],u=()=>(0,o.jsxs)("div",{className:"ds-settings-wrap",children:[(0,o.jsx)("div",{className:"ds-settings-header",children:(0,o.jsxs)("div",{className:"ds-settings-header-inner",children:[(0,o.jsx)("div",{className:"ds-skeleton ds-skeleton-logo"}),(0,o.jsx)("div",{className:"ds-skeleton ds-skeleton-title"})]})}),(0,o.jsx)("div",{className:"ds-settings-content",children:(0,o.jsxs)("div",{className:"ds-skeleton-content",children:[(0,o.jsxs)("div",{className:"ds-skeleton-field",children:[(0,o.jsx)("div",{className:"ds-skeleton ds-skeleton-label"}),(0,o.jsx)("div",{className:"ds-skeleton ds-skeleton-toggle"})]}),(0,o.jsxs)("div",{className:"ds-skeleton-field",children:[(0,o.jsx)("div",{className:"ds-skeleton ds-skeleton-label"}),(0,o.jsx)("div",{className:"ds-skeleton ds-skeleton-toggle"})]}),(0,o.jsxs)("div",{className:"ds-skeleton-field",children:[(0,o.jsx)("div",{className:"ds-skeleton ds-skeleton-label"}),(0,o.jsx)("div",{className:"ds-skeleton ds-skeleton-toggle"})]})]})})]}),p=({ok:s,label:a})=>(0,o.jsxs)("span",{className:"ds-status-badge "+(s?"ds-status-ok":"ds-status-error"),children:[s?"âœ“":"âœ—"," ",a]}),v=({settings:s,onChange:a,onSave:e,saving:t})=>{const i=s?.gdpr_mode??s?._is_eu??!1,n=s?._detected_country||"",l=s?._is_eu??!1;return(0,o.jsxs)("div",{className:"ds-settings-card",children:[(0,o.jsx)("div",{className:"ds-settings-card-header",children:(0,o.jsxs)("h3",{children:[(0,d.__)("GDPR Compliance","data-signals"),n&&(0,o.jsx)("span",{className:"ds-detected-country",children:l?(0,d.sprintf)((0,d.__)("Auto-detected: %s (EU)","data-signals"),n):(0,d.sprintf)((0,d.__)("Detected: %s","data-signals"),n)})]})}),(0,o.jsxs)("div",{className:"ds-settings-card-body",children:[(0,o.jsx)(r,{fields:c,data:s,onChange:a,onSave:e,saving:t,hideHeader:!0}),i&&(0,o.jsxs)("div",{className:"ds-gdpr-info",children:[(0,o.jsx)("strong",{children:(0,d.__)("When enabled:","data-signals")}),(0,o.jsx)("ul",{children:g.map((s,a)=>(0,o.jsx)("li",{children:s},a))})]})]})]})},b=({diagnostics:s,loading:a,onDownloadGeoLite2:e,downloading:t})=>{if(a)return(0,o.jsxs)("div",{className:"ds-settings-card",children:[(0,o.jsx)("div",{className:"ds-settings-card-header",children:(0,o.jsx)("h3",{children:(0,d.__)("System Status","data-signals")})}),(0,o.jsx)("div",{className:"ds-settings-card-body",style:{textAlign:"center",padding:"20px"},children:(0,o.jsx)(l.Spinner,{})})]});if(!s)return null;const{cloudflare:i,geolite2:n,geolite2_updater:r,buffer:c,settings:g}=s;return(0,o.jsxs)("div",{className:"ds-settings-card",children:[(0,o.jsx)("div",{className:"ds-settings-card-header",children:(0,o.jsx)("h3",{children:(0,d.__)("System Status","data-signals")})}),(0,o.jsxs)("div",{className:"ds-settings-card-body ds-diagnostics",children:[(0,o.jsxs)("div",{className:"ds-diagnostic-row",children:[(0,o.jsx)("div",{className:"ds-diagnostic-label",children:(0,o.jsx)("strong",{children:(0,d.__)("Cloudflare","data-signals")})}),(0,o.jsxs)("div",{className:"ds-diagnostic-value",children:[(0,o.jsx)(p,{ok:i?.ok,label:i?.status}),(0,o.jsx)("p",{className:"ds-diagnostic-message",children:i?.message})]})]}),(0,o.jsxs)("div",{className:"ds-diagnostic-row",children:[(0,o.jsx)("div",{className:"ds-diagnostic-label",children:(0,o.jsx)("strong",{children:(0,d.__)("GeoLite2 Database","data-signals")})}),(0,o.jsxs)("div",{className:"ds-diagnostic-value",children:[(0,o.jsx)(p,{ok:n?.ok,label:n?.status}),(0,o.jsx)("p",{className:"ds-diagnostic-message",children:n?.message}),null!==r?.db_age_days&&(0,o.jsx)("p",{className:"ds-diagnostic-message",children:(0,d.sprintf)((0,d.__)("Database age: %d days","data-signals"),r.db_age_days)}),(0,o.jsxs)("div",{style:{marginTop:"12px"},children:[(0,o.jsx)(l.Button,{variant:"secondary",onClick:e,isBusy:t,disabled:t||!g?.has_license_key,children:t?(0,d.__)("Downloadingâ€¦","data-signals"):(0,d.__)("Download/Update GeoLite2","data-signals")}),!g?.has_license_key&&(0,o.jsx)("p",{className:"ds-diagnostic-message",style:{marginTop:"8px"},children:(0,d.__)("Add MaxMind license key in Geolocation settings below.","data-signals")})]})]})]}),(0,o.jsxs)("div",{className:"ds-diagnostic-row",children:[(0,o.jsx)("div",{className:"ds-diagnostic-label",children:(0,o.jsx)("strong",{children:(0,d.__)("Buffer","data-signals")})}),(0,o.jsxs)("div",{className:"ds-diagnostic-value",children:[(0,o.jsx)(p,{ok:c?.ok,label:c?.status}),(0,o.jsx)("p",{className:"ds-diagnostic-message",children:c?.message})]})]})]})]})},j=()=>{const[s,a]=(0,t.useState)({}),[e,i]=(0,t.useState)(null),[c,g]=(0,t.useState)(!0),[p,j]=(0,t.useState)(!0),[y,f]=(0,t.useState)(null),[N,k]=(0,t.useState)(!1),[w,S]=(0,t.useState)([]),C=(0,t.useCallback)(s=>{S(a=>a.filter(a=>a.id!==s))},[]),D=(0,t.useCallback)((s,a)=>{const e=`${Date.now()}-${Math.random().toString(16).slice(2)}`,t={id:e,status:s,content:a};S(s=>[t,...s].slice(0,5)),setTimeout(()=>C(e),6e3)},[C]),E=(0,t.useCallback)(async()=>{try{const s=await n()({path:"/data-signals/v1/settings"});a(s)}catch(s){D("error",(0,d.__)("Error loading settings.","data-signals"))}finally{g(!1)}},[D]),L=(0,t.useCallback)(async()=>{try{const s=await n()({path:"/data-signals/v1/diagnostics"});i(s)}catch(s){console.error("Error fetching diagnostics:",s)}finally{j(!1)}},[]);(0,t.useEffect)(()=>{E(),L()},[E,L]);const O=async a=>{f(a);try{await n()({path:"/data-signals/v1/settings",method:"POST",data:s}),D("success",(0,d.__)("Settings saved!","data-signals")),L()}catch(s){D("error",(0,d.__)("Error saving settings.","data-signals"))}finally{f(null)}},P=s=>{a(a=>({...a,...s}))};return c?(0,o.jsx)(u,{}):(0,o.jsxs)("div",{className:"ds-settings-wrap",children:[(0,o.jsx)("div",{className:"ds-settings-header",children:(0,o.jsxs)("div",{className:"ds-settings-header-inner",children:[(0,o.jsx)("span",{className:"ds-icon",children:"ðŸ“Š"}),(0,o.jsx)("span",{className:"ds-settings-title",children:"Data Signals"})]})}),(0,o.jsx)("div",{className:"ds-toast-container",children:(0,o.jsx)(l.SnackbarList,{notices:w,onRemove:C})}),(0,o.jsxs)("div",{className:"ds-settings-content",children:[(0,o.jsx)(v,{settings:s,onChange:P,onSave:()=>O("gdpr"),saving:"gdpr"===y}),(0,o.jsx)(b,{diagnostics:e,loading:p,onDownloadGeoLite2:async()=>{k(!0);try{const s=await n()({path:"/data-signals/v1/geolite2/download",method:"POST"});D("success",s.message||(0,d.__)("GeoLite2 database updated!","data-signals")),L()}catch(s){const a=s?.message||(0,d.__)("Download failed.","data-signals");D("error",a)}finally{k(!1)}},downloading:N}),(0,o.jsx)(r,{title:(0,d.__)("Tracking Options","data-signals"),fields:_,data:s,onChange:P,onSave:()=>O("tracking"),saving:"tracking"===y}),(0,o.jsx)(r,{title:(0,d.__)("Geolocation","data-signals"),fields:h,data:s,onChange:P,onSave:()=>O("geo"),saving:"geo"===y}),(0,o.jsx)(r,{title:(0,d.__)("Data Retention","data-signals"),fields:x,data:s,onChange:P,onSave:()=>O("retention"),saving:"retention"===y}),(0,o.jsx)(r,{title:(0,d.__)("Dashboard Options","data-signals"),fields:m,data:s,onChange:P,onSave:()=>O("dashboard"),saving:"dashboard"===y})]})]})};window.dataSignalsAdmin&&(n().use(n().createNonceMiddleware(window.dataSignalsAdmin.restNonce)),n().use(n().createRootURLMiddleware(window.dataSignalsAdmin.restUrl)));const y=document.getElementById("data-signals-settings");y&&(0,t.createRoot)(y).render((0,o.jsx)(j,{}))}},e={};function t(s){var i=e[s];if(void 0!==i)return i.exports;var n=e[s]={exports:{}};return a[s](n,n.exports,t),n.exports}t.m=a,s=[],t.O=(a,e,i,n)=>{if(!e){var d=1/0;for(c=0;c<s.length;c++){for(var[e,i,n]=s[c],l=!0,o=0;o<e.length;o++)(!1&n||d>=n)&&Object.keys(t.O).every(s=>t.O[s](e[o]))?e.splice(o--,1):(l=!1,n<d&&(d=n));if(l){s.splice(c--,1);var r=i();void 0!==r&&(a=r)}}return a}n=n||0;for(var c=s.length;c>0&&s[c-1][2]>n;c--)s[c]=s[c-1];s[c]=[e,i,n]},t.n=s=>{var a=s&&s.__esModule?()=>s.default:()=>s;return t.d(a,{a}),a},t.d=(s,a)=>{for(var e in a)t.o(a,e)&&!t.o(s,e)&&Object.defineProperty(s,e,{enumerable:!0,get:a[e]})},t.o=(s,a)=>Object.prototype.hasOwnProperty.call(s,a),(()=>{var s={641:0,69:0};t.O.j=a=>0===s[a];var a=(a,e)=>{var i,n,[d,l,o]=e,r=0;if(d.some(a=>0!==s[a])){for(i in l)t.o(l,i)&&(t.m[i]=l[i]);if(o)var c=o(t)}for(a&&a(e);r<d.length;r++)n=d[r],t.o(s,n)&&s[n]&&s[n][0](),s[n]=0;return t.O(c)},e=globalThis.webpackChunkdata_signals=globalThis.webpackChunkdata_signals||[];e.forEach(a.bind(null,0)),e.push=a.bind(null,e.push.bind(e))})();var i=t.O(void 0,[69],()=>t(168));i=t.O(i)})();