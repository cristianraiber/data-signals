(()=>{"use strict";var e,a={168(e,a,s){const t=window.wp.element,n=window.wp.apiFetch;var l=s.n(n);const i=window.wp.i18n,d=window.wp.components,o=window.ReactJSXRuntime,r=({title:e,fields:a,data:s,onChange:t,onSave:n,saving:l,hideHeader:r=!1,hideFooter:c=!1,beforeFields:g=null,afterFields:_=null})=>(0,o.jsxs)("div",{className:"ds-settings-card"+(r?" ds-settings-card-inline":""),children:[!r&&(0,o.jsx)("div",{className:"ds-settings-card-header",children:(0,o.jsx)("h3",{children:e})}),(0,o.jsxs)("div",{className:"ds-settings-card-body",children:[g,a.map(e=>{const a=s[e.id];return"boolean"===e.type?(0,o.jsx)(d.ToggleControl,{__nextHasNoMarginBottom:!0,label:e.label,help:e.description,checked:!!a,onChange:a=>t({[e.id]:a})},e.id):"radio"===e.type&&e.elements?(0,o.jsx)(d.RadioControl,{label:e.label,help:e.description,selected:a||e.elements[0]?.value,options:e.elements,onChange:a=>t({[e.id]:a})},e.id):e.elements&&e.elements.length>0?(0,o.jsx)(d.SelectControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,label:e.label,help:e.description,value:a||"",options:e.elements,onChange:a=>t({[e.id]:a})},e.id):"text"===e.type&&"input"===e.Edit?(0,o.jsx)(d.TextControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,label:e.label,help:e.description,value:a||"",onChange:a=>t({[e.id]:a}),placeholder:e.placeholder||""},e.id):null}),_]}),!c&&(0,o.jsx)("div",{className:"ds-settings-card-footer",children:(0,o.jsx)(d.Button,{variant:"primary",onClick:n,isBusy:l,disabled:l,children:l?(0,i.__)("Savingâ€¦","data-signals"):(0,i.__)("Save","data-signals")})})]}),c=[(0,i.__)("IP addresses are anonymized before processing","data-signals"),(0,i.__)("Do Not Track (DNT) browser header is respected","data-signals"),(0,i.__)("No cookies are used (fingerprint-based sessions)","data-signals"),(0,i.__)("Session data rotates daily for privacy","data-signals"),(0,i.__)("No personal identifiable information is stored","data-signals")],g=[{id:"prune_data_after_months",label:(0,i.__)("Data Retention Period","data-signals"),type:"text",elements:[{value:"6",label:(0,i.__)("6 months","data-signals")},{value:"12",label:(0,i.__)("1 year","data-signals")},{value:"24",label:(0,i.__)("2 years","data-signals")},{value:"36",label:(0,i.__)("3 years","data-signals")},{value:"0",label:(0,i.__)("Forever","data-signals")}],description:(0,i.__)("How long to keep analytics data before automatic deletion.","data-signals")},{id:"default_view",label:(0,i.__)("Default Date Range","data-signals"),type:"text",elements:[{value:"last_7_days",label:(0,i.__)("Last 7 days","data-signals")},{value:"last_14_days",label:(0,i.__)("Last 14 days","data-signals")},{value:"last_28_days",label:(0,i.__)("Last 28 days","data-signals")},{value:"this_month",label:(0,i.__)("This month","data-signals")}],description:(0,i.__)("Default time period shown on the dashboard.","data-signals")},{id:"is_dashboard_public",label:(0,i.__)("Public Dashboard","data-signals"),type:"boolean",Edit:"toggle",description:(0,i.__)("Allow anyone with the REST API endpoint to view stats (no auth required).","data-signals")}],_=[{id:"geo_method",label:(0,i.__)("Geolocation Method","data-signals"),type:"radio",elements:[{value:"geolite2",label:(0,i.__)("GeoLite2 Database (recommended)","data-signals")},{value:"cloudflare",label:(0,i.__)("Cloudflare IP Geolocation","data-signals")},{value:"none",label:(0,i.__)("Disabled","data-signals")}],description:(0,i.__)("Choose how to detect visitor country. GeoLite2 requires MaxMind license key.","data-signals")},{id:"maxmind_license_key",label:(0,i.__)("MaxMind License Key","data-signals"),type:"text",Edit:"input",description:(0,i.__)("Free license key from maxmind.com. Required for GeoLite2 database downloads.","data-signals"),placeholder:"xxxxxxxxxxxxxxxx"},{id:"geolite2_db_path",label:(0,i.__)("GeoLite2 Database Path (Optional)","data-signals"),type:"text",Edit:"input",description:(0,i.__)("Custom path to GeoLite2-Country.mmdb. Leave empty for automatic download.","data-signals")}],h=()=>(0,o.jsxs)("div",{className:"ds-settings-wrap",children:[(0,o.jsx)("div",{className:"ds-settings-header",children:(0,o.jsxs)("div",{className:"ds-settings-header-inner",children:[(0,o.jsx)("div",{className:"ds-skeleton ds-skeleton-logo"}),(0,o.jsx)("div",{className:"ds-skeleton ds-skeleton-title"})]})}),(0,o.jsx)("div",{className:"ds-settings-content",children:(0,o.jsx)("div",{className:"ds-skeleton-content",children:[1,2,3].map(e=>(0,o.jsxs)("div",{className:"ds-skeleton-field",children:[(0,o.jsx)("div",{className:"ds-skeleton ds-skeleton-label"}),(0,o.jsx)("div",{className:"ds-skeleton ds-skeleton-toggle"})]},e))})})]}),p=({roles:e,settings:a,onChange:s})=>e&&0!==e.length?(0,o.jsxs)("div",{className:"ds-role-toggles",children:[(0,o.jsx)("h4",{style:{margin:"0 0 12px",fontSize:"13px",fontWeight:600,color:"#1e1e1e"},children:(0,i.__)("Exclude User Roles","data-signals")}),(0,o.jsx)("p",{style:{margin:"0 0 16px",fontSize:"12px",color:"#757575"},children:(0,i.__)("Do not track pageviews from these logged-in users.","data-signals")}),e.map(e=>{const t=`exclude_role_${e.slug}`;return(0,o.jsx)(d.ToggleControl,{__nextHasNoMarginBottom:!0,label:e.name,checked:!!a[t],onChange:e=>s({[t]:e})},t)})]}):null,m=({settings:e,onChange:a})=>{const s=!!e?.gdpr_mode,t=e?._detected_country||"",n=e?._is_eu??!1;return(0,o.jsxs)("div",{className:"ds-gdpr-section",children:[(0,o.jsx)(d.ToggleControl,{__nextHasNoMarginBottom:!0,label:(0,o.jsxs)(o.Fragment,{children:[(0,i.__)("Enable GDPR Mode","data-signals"),t&&(0,o.jsx)("span",{className:"ds-detected-badge",children:n?`${t} (EU)`:t})]}),help:(0,i.__)("Privacy-compliant analytics for EU/EEA sites.","data-signals"),checked:s,onChange:e=>a({gdpr_mode:e})}),s&&(0,o.jsx)("div",{className:"ds-gdpr-info",children:(0,o.jsx)("ul",{children:c.map((e,a)=>(0,o.jsxs)("li",{children:["âœ“ ",e]},a))})})]})},x=()=>{const[e,a]=(0,t.useState)({}),[s,n]=(0,t.useState)(!0),[c,x]=(0,t.useState)(null),[u,v]=(0,t.useState)([]),b=(0,t.useCallback)(e=>{v(a=>a.filter(a=>a.id!==e))},[]),f=(0,t.useCallback)((e,a)=>{const s=`${Date.now()}-${Math.random().toString(16).slice(2)}`,t={id:s,status:e,content:a};v(e=>[t,...e].slice(0,5)),setTimeout(()=>b(s),6e3)},[b]),y=(0,t.useCallback)(async()=>{try{const e=await l()({path:"/data-signals/v1/settings"});a(e)}catch(e){f("error",(0,i.__)("Error loading settings.","data-signals"))}finally{n(!1)}},[f]);(0,t.useEffect)(()=>{y()},[y]);const j=async a=>{x(a);try{await l()({path:"/data-signals/v1/settings",method:"POST",data:e}),f("success",(0,i.__)("Settings saved!","data-signals"))}catch(e){f("error",(0,i.__)("Error saving settings.","data-signals"))}finally{x(null)}},w=e=>{a(a=>({...a,...e}))};return s?(0,o.jsx)(h,{}):(0,o.jsxs)("div",{className:"ds-settings-wrap",children:[(0,o.jsx)("div",{className:"ds-settings-header",children:(0,o.jsxs)("div",{className:"ds-settings-header-inner",children:[(0,o.jsx)("span",{className:"ds-icon",children:"ðŸ“Š"}),(0,o.jsx)("span",{className:"ds-settings-title",children:"Data Signals"})]})}),(0,o.jsx)("div",{className:"ds-toast-container",children:(0,o.jsx)(d.SnackbarList,{notices:u,onRemove:b})}),(0,o.jsxs)("div",{className:"ds-settings-content",children:[(0,o.jsx)(r,{title:(0,i.__)("Tracking Options","data-signals"),fields:g,data:e,onChange:w,onSave:()=>j("tracking"),saving:"tracking"===c,beforeFields:(0,o.jsx)(p,{roles:e._user_roles,settings:e,onChange:w}),afterFields:(0,o.jsx)(m,{settings:e,onChange:w})}),(0,o.jsx)(r,{title:(0,i.__)("Geolocation","data-signals"),fields:_,data:e,onChange:w,onSave:()=>j("geo"),saving:"geo"===c})]})]})};window.dataSignalsAdmin&&(l().use(l().createNonceMiddleware(window.dataSignalsAdmin.restNonce)),l().use(l().createRootURLMiddleware(window.dataSignalsAdmin.restUrl)));const u=document.getElementById("data-signals-settings");u&&(0,t.createRoot)(u).render((0,o.jsx)(x,{}))}},s={};function t(e){var n=s[e];if(void 0!==n)return n.exports;var l=s[e]={exports:{}};return a[e](l,l.exports,t),l.exports}t.m=a,e=[],t.O=(a,s,n,l)=>{if(!s){var i=1/0;for(c=0;c<e.length;c++){for(var[s,n,l]=e[c],d=!0,o=0;o<s.length;o++)(!1&l||i>=l)&&Object.keys(t.O).every(e=>t.O[e](s[o]))?s.splice(o--,1):(d=!1,l<i&&(i=l));if(d){e.splice(c--,1);var r=n();void 0!==r&&(a=r)}}return a}l=l||0;for(var c=e.length;c>0&&e[c-1][2]>l;c--)e[c]=e[c-1];e[c]=[s,n,l]},t.n=e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},t.d=(e,a)=>{for(var s in a)t.o(a,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:a[s]})},t.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),(()=>{var e={641:0,69:0};t.O.j=a=>0===e[a];var a=(a,s)=>{var n,l,[i,d,o]=s,r=0;if(i.some(a=>0!==e[a])){for(n in d)t.o(d,n)&&(t.m[n]=d[n]);if(o)var c=o(t)}for(a&&a(s);r<i.length;r++)l=i[r],t.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return t.O(c)},s=globalThis.webpackChunkdata_signals=globalThis.webpackChunkdata_signals||[];s.forEach(a.bind(null,0)),s.push=a.bind(null,s.push.bind(s))})();var n=t.O(void 0,[69],()=>t(168));n=t.O(n)})();