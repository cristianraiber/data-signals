(()=>{"use strict";var s,a={168(s,a,e){const t=window.wp.element,i=window.wp.apiFetch;var l=e.n(i);const n=window.wp.i18n,d=window.wp.components,o=window.ReactJSXRuntime,r=({title:s,fields:a,data:e,onChange:t,onSave:i,saving:l})=>(0,o.jsxs)("div",{className:"ds-settings-card",children:[(0,o.jsx)("div",{className:"ds-settings-card-header",children:(0,o.jsx)("h3",{children:s})}),(0,o.jsx)("div",{className:"ds-settings-card-body",children:a.map(s=>{const a=e[s.id];return"boolean"===s.type?(0,o.jsx)(d.ToggleControl,{__nextHasNoMarginBottom:!0,label:s.label,help:s.description,checked:!!a,onChange:a=>t({[s.id]:a})},s.id):s.elements&&s.elements.length>0?(0,o.jsx)(d.SelectControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,label:s.label,help:s.description,value:a||"",options:s.elements,onChange:a=>t({[s.id]:a})},s.id):"text"===s.type&&"input"===s.Edit?(0,o.jsx)(d.TextControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,label:s.label,help:s.description,value:a||"",onChange:a=>t({[s.id]:a}),placeholder:s.placeholder||""},s.id):null})}),(0,o.jsx)("div",{className:"ds-settings-card-footer",children:(0,o.jsx)(d.Button,{variant:"primary",onClick:i,isBusy:l,disabled:l,children:l?(0,n.__)("Savingâ€¦","data-signals"):(0,n.__)("Save","data-signals")})})]}),c=[{id:"exclude_administrators",label:(0,n.__)("Exclude Logged-in Admins","data-signals"),type:"boolean",Edit:"toggle",description:(0,n.__)("Do not track pageviews from administrators.","data-signals")},{id:"exclude_editors",label:(0,n.__)("Exclude Editors","data-signals"),type:"boolean",Edit:"toggle",description:(0,n.__)("Do not track pageviews from editors.","data-signals")}],g=[{id:"maxmind_license_key",label:(0,n.__)("MaxMind License Key","data-signals"),type:"text",Edit:"input",description:(0,n.__)("Free license key from maxmind.com. Required for automatic GeoLite2 database downloads.","data-signals"),placeholder:"xxxxxxxxxxxxxxxx"},{id:"geo_use_cloudflare",label:(0,n.__)("Use Cloudflare IP Geolocation","data-signals"),type:"boolean",Edit:"toggle",description:(0,n.__)("Use Cloudflare CF-IPCountry header if available. Requires IP Geolocation enabled in Cloudflare.","data-signals")},{id:"geo_api_fallback",label:(0,n.__)("Enable API Fallback (Dev Only)","data-signals"),type:"boolean",Edit:"toggle",description:(0,n.__)("Fall back to ip-api.com when GeoLite2 unavailable. Rate limited (45 req/min), not for production.","data-signals")},{id:"geolite2_db_path",label:(0,n.__)("GeoLite2 Database Path (Optional)","data-signals"),type:"text",Edit:"input",description:(0,n.__)("Custom path to GeoLite2-Country.mmdb. Leave empty for automatic download to wp-content/uploads/data-signals/.","data-signals")}],_=[{id:"prune_data_after_months",label:(0,n.__)("Data Retention Period","data-signals"),type:"text",elements:[{value:"6",label:(0,n.__)("6 months","data-signals")},{value:"12",label:(0,n.__)("1 year","data-signals")},{value:"24",label:(0,n.__)("2 years","data-signals")},{value:"36",label:(0,n.__)("3 years","data-signals")},{value:"0",label:(0,n.__)("Forever","data-signals")}],description:(0,n.__)("How long to keep analytics data before automatic deletion.","data-signals")}],h=[{id:"default_view",label:(0,n.__)("Default Date Range","data-signals"),type:"text",elements:[{value:"last_7_days",label:(0,n.__)("Last 7 days","data-signals")},{value:"last_14_days",label:(0,n.__)("Last 14 days","data-signals")},{value:"last_28_days",label:(0,n.__)("Last 28 days","data-signals")},{value:"this_month",label:(0,n.__)("This month","data-signals")}],description:(0,n.__)("Default time period shown on the dashboard.","data-signals")},{id:"is_dashboard_public",label:(0,n.__)("Public Dashboard","data-signals"),type:"boolean",Edit:"toggle",description:(0,n.__)("Allow anyone with the REST API endpoint to view stats (no auth required).","data-signals")}],x=()=>(0,o.jsxs)("div",{className:"ds-settings-wrap",children:[(0,o.jsx)("div",{className:"ds-settings-header",children:(0,o.jsxs)("div",{className:"ds-settings-header-inner",children:[(0,o.jsx)("div",{className:"ds-skeleton ds-skeleton-logo"}),(0,o.jsx)("div",{className:"ds-skeleton ds-skeleton-title"})]})}),(0,o.jsx)("div",{className:"ds-settings-content",children:(0,o.jsxs)("div",{className:"ds-skeleton-content",children:[(0,o.jsxs)("div",{className:"ds-skeleton-field",children:[(0,o.jsx)("div",{className:"ds-skeleton ds-skeleton-label"}),(0,o.jsx)("div",{className:"ds-skeleton ds-skeleton-toggle"})]}),(0,o.jsxs)("div",{className:"ds-skeleton-field",children:[(0,o.jsx)("div",{className:"ds-skeleton ds-skeleton-label"}),(0,o.jsx)("div",{className:"ds-skeleton ds-skeleton-toggle"})]}),(0,o.jsxs)("div",{className:"ds-skeleton-field",children:[(0,o.jsx)("div",{className:"ds-skeleton ds-skeleton-label"}),(0,o.jsx)("div",{className:"ds-skeleton ds-skeleton-toggle"})]})]})})]}),m=({ok:s,label:a})=>(0,o.jsxs)("span",{className:"ds-status-badge "+(s?"ds-status-ok":"ds-status-error"),children:[s?"âœ“":"âœ—"," ",a]}),u=({diagnostics:s,loading:a,onDownloadGeoLite2:e,downloading:t})=>{if(a)return(0,o.jsxs)("div",{className:"ds-settings-card",children:[(0,o.jsx)("div",{className:"ds-settings-card-header",children:(0,o.jsx)("h3",{children:(0,n.__)("System Status","data-signals")})}),(0,o.jsx)("div",{className:"ds-settings-card-body",style:{textAlign:"center",padding:"20px"},children:(0,o.jsx)(d.Spinner,{})})]});if(!s)return null;const{cloudflare:i,geolite2:l,geolite2_updater:r,buffer:c,settings:g}=s;return(0,o.jsxs)("div",{className:"ds-settings-card",children:[(0,o.jsx)("div",{className:"ds-settings-card-header",children:(0,o.jsx)("h3",{children:(0,n.__)("System Status","data-signals")})}),(0,o.jsxs)("div",{className:"ds-settings-card-body ds-diagnostics",children:[(0,o.jsxs)("div",{className:"ds-diagnostic-row",children:[(0,o.jsx)("div",{className:"ds-diagnostic-label",children:(0,o.jsx)("strong",{children:(0,n.__)("Cloudflare","data-signals")})}),(0,o.jsxs)("div",{className:"ds-diagnostic-value",children:[(0,o.jsx)(m,{ok:i?.ok,label:i?.status}),(0,o.jsx)("p",{className:"ds-diagnostic-message",children:i?.message})]})]}),(0,o.jsxs)("div",{className:"ds-diagnostic-row",children:[(0,o.jsx)("div",{className:"ds-diagnostic-label",children:(0,o.jsx)("strong",{children:(0,n.__)("GeoLite2 Database","data-signals")})}),(0,o.jsxs)("div",{className:"ds-diagnostic-value",children:[(0,o.jsx)(m,{ok:l?.ok,label:l?.status}),(0,o.jsx)("p",{className:"ds-diagnostic-message",children:l?.message}),null!==r?.db_age_days&&(0,o.jsx)("p",{className:"ds-diagnostic-message",children:(0,n.sprintf)((0,n.__)("Database age: %d days","data-signals"),r.db_age_days)}),(0,o.jsxs)("div",{style:{marginTop:"12px"},children:[(0,o.jsx)(d.Button,{variant:"secondary",onClick:e,isBusy:t,disabled:t||!g?.has_license_key,children:t?(0,n.__)("Downloadingâ€¦","data-signals"):(0,n.__)("Download/Update GeoLite2","data-signals")}),!g?.has_license_key&&(0,o.jsx)("p",{className:"ds-diagnostic-message",style:{marginTop:"8px"},children:(0,n.__)("Add MaxMind license key in Geolocation settings below.","data-signals")})]})]})]}),(0,o.jsxs)("div",{className:"ds-diagnostic-row",children:[(0,o.jsx)("div",{className:"ds-diagnostic-label",children:(0,o.jsx)("strong",{children:(0,n.__)("Buffer","data-signals")})}),(0,o.jsxs)("div",{className:"ds-diagnostic-value",children:[(0,o.jsx)(m,{ok:c?.ok,label:c?.status}),(0,o.jsx)("p",{className:"ds-diagnostic-message",children:c?.message})]})]})]})]})},v=()=>{const[s,a]=(0,t.useState)({}),[e,i]=(0,t.useState)(null),[m,v]=(0,t.useState)(!0),[p,b]=(0,t.useState)(!0),[j,y]=(0,t.useState)(null),[f,w]=(0,t.useState)(!1),[k,N]=(0,t.useState)([]),S=(0,t.useCallback)(s=>{N(a=>a.filter(a=>a.id!==s))},[]),C=(0,t.useCallback)((s,a)=>{const e=`${Date.now()}-${Math.random().toString(16).slice(2)}`,t={id:e,status:s,content:a};N(s=>[t,...s].slice(0,5)),setTimeout(()=>S(e),6e3)},[S]),D=(0,t.useCallback)(async()=>{try{const s=await l()({path:"/data-signals/v1/settings"});a(s)}catch(s){C("error",(0,n.__)("Error loading settings.","data-signals"))}finally{v(!1)}},[C]),E=(0,t.useCallback)(async()=>{try{const s=await l()({path:"/data-signals/v1/diagnostics"});i(s)}catch(s){console.error("Error fetching diagnostics:",s)}finally{b(!1)}},[]);(0,t.useEffect)(()=>{D(),E()},[D,E]);const L=async a=>{y(a);try{await l()({path:"/data-signals/v1/settings",method:"POST",data:s}),C("success",(0,n.__)("Settings saved!","data-signals")),E()}catch(s){C("error",(0,n.__)("Error saving settings.","data-signals"))}finally{y(null)}},O=s=>{a(a=>({...a,...s}))};return m?(0,o.jsx)(x,{}):(0,o.jsxs)("div",{className:"ds-settings-wrap",children:[(0,o.jsx)("div",{className:"ds-settings-header",children:(0,o.jsxs)("div",{className:"ds-settings-header-inner",children:[(0,o.jsx)("span",{className:"ds-icon",children:"ðŸ“Š"}),(0,o.jsx)("span",{className:"ds-settings-title",children:"Data Signals"})]})}),(0,o.jsx)("div",{className:"ds-toast-container",children:(0,o.jsx)(d.SnackbarList,{notices:k,onRemove:S})}),(0,o.jsxs)("div",{className:"ds-settings-content",children:[(0,o.jsx)(u,{diagnostics:e,loading:p,onDownloadGeoLite2:async()=>{w(!0);try{const s=await l()({path:"/data-signals/v1/geolite2/download",method:"POST"});C("success",s.message||(0,n.__)("GeoLite2 database updated!","data-signals")),E()}catch(s){const a=s?.message||(0,n.__)("Download failed.","data-signals");C("error",a)}finally{w(!1)}},downloading:f}),(0,o.jsx)(r,{title:(0,n.__)("Tracking Options","data-signals"),fields:c,data:s,onChange:O,onSave:()=>L("tracking"),saving:"tracking"===j}),(0,o.jsx)(r,{title:(0,n.__)("Geolocation","data-signals"),fields:g,data:s,onChange:O,onSave:()=>L("geo"),saving:"geo"===j}),(0,o.jsx)(r,{title:(0,n.__)("Data Retention","data-signals"),fields:_,data:s,onChange:O,onSave:()=>L("retention"),saving:"retention"===j}),(0,o.jsx)(r,{title:(0,n.__)("Dashboard Options","data-signals"),fields:h,data:s,onChange:O,onSave:()=>L("dashboard"),saving:"dashboard"===j})]})]})};window.dataSignalsAdmin&&(l().use(l().createNonceMiddleware(window.dataSignalsAdmin.restNonce)),l().use(l().createRootURLMiddleware(window.dataSignalsAdmin.restUrl)));const p=document.getElementById("data-signals-settings");p&&(0,t.createRoot)(p).render((0,o.jsx)(v,{}))}},e={};function t(s){var i=e[s];if(void 0!==i)return i.exports;var l=e[s]={exports:{}};return a[s](l,l.exports,t),l.exports}t.m=a,s=[],t.O=(a,e,i,l)=>{if(!e){var n=1/0;for(c=0;c<s.length;c++){for(var[e,i,l]=s[c],d=!0,o=0;o<e.length;o++)(!1&l||n>=l)&&Object.keys(t.O).every(s=>t.O[s](e[o]))?e.splice(o--,1):(d=!1,l<n&&(n=l));if(d){s.splice(c--,1);var r=i();void 0!==r&&(a=r)}}return a}l=l||0;for(var c=s.length;c>0&&s[c-1][2]>l;c--)s[c]=s[c-1];s[c]=[e,i,l]},t.n=s=>{var a=s&&s.__esModule?()=>s.default:()=>s;return t.d(a,{a}),a},t.d=(s,a)=>{for(var e in a)t.o(a,e)&&!t.o(s,e)&&Object.defineProperty(s,e,{enumerable:!0,get:a[e]})},t.o=(s,a)=>Object.prototype.hasOwnProperty.call(s,a),(()=>{var s={641:0,69:0};t.O.j=a=>0===s[a];var a=(a,e)=>{var i,l,[n,d,o]=e,r=0;if(n.some(a=>0!==s[a])){for(i in d)t.o(d,i)&&(t.m[i]=d[i]);if(o)var c=o(t)}for(a&&a(e);r<n.length;r++)l=n[r],t.o(s,l)&&s[l]&&s[l][0](),s[l]=0;return t.O(c)},e=globalThis.webpackChunkdata_signals=globalThis.webpackChunkdata_signals||[];e.forEach(a.bind(null,0)),e.push=a.bind(null,e.push.bind(e))})();var i=t.O(void 0,[69],()=>t(168));i=t.O(i)})();